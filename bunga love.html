<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Animasi Love Berbunga ðŸ’—ðŸŒ¸</title>
<style>
  :root{
    --bg1: #1b1420;
    --bg2: #2a132b;
    --pink1: #ff8fb3;
    --pink2: #ffc0d6;
    --accent: #ffd6e8;
    --glass: rgba(255,255,255,0.04);
  }
  *{box-sizing:border-box}
  html,body{height:100%; margin:0; font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;}
  body{
    display:flex;
    align-items:center;
    justify-content:center;
    background:
      radial-gradient(ellipse at 10% 10%, rgba(255,200,230,0.06), transparent 10%),
      linear-gradient(180deg, var(--bg1), var(--bg2));
    color:white;
    overflow:hidden;
  }

  /* Stage */
  .stage{
    width:min(1100px,95vw);
    height:min(760px,92vh);
    border-radius:18px;
    padding:18px;
    display:grid;
    grid-template-columns: 1fr 320px;
    gap:16px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
    box-shadow: 0 12px 50px rgba(10,6,20,0.7);
    position:relative;
    overflow:hidden;
    border: 1px solid rgba(255,255,255,0.03);
  }

  /* canvas area */
  .canvas-wrap{
    position:relative;
    overflow:hidden;
    border-radius:12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  }

  canvas{ width:100%; height:100%; display:block; }

  /* center heart */
  .heart-wrap{
    position:absolute;
    left:50%; top:45%;
    transform:translate(-50%,-50%);
    z-index:6;
    pointer-events:none;
  }
  svg.heart {
    width:320px; height:320px;
    filter: drop-shadow(0 18px 28px rgba(0,0,0,0.6));
  }
  /* glowing pulse */
  @keyframes pulse {
    0% { transform: scale(0.98) translateY(0); filter: drop-shadow(0 8px 20px rgba(255,120,160,0.08)); }
    50% { transform: scale(1.03) translateY(-6px); filter: drop-shadow(0 28px 40px rgba(255,120,160,0.18)); }
    100% { transform: scale(0.98) translateY(0); }
  }
  .heart-wrap .pulse{
    animation: pulse 2400ms ease-in-out infinite;
    transform-origin:center;
  }

  /* right panel controls */
  .panel{
    padding:12px;
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  .panel h3{ margin:0; color:var(--pink2) }
  .controls{ display:flex; gap:8px; flex-wrap:wrap; }
  .controls button{
    padding:8px 10px; border-radius:10px;
    border:1px solid rgba(255,255,255,0.06);
    background:transparent; color:inherit; cursor:pointer;
  }
  .controls input[type="range"]{ width:100%; }

  .meta{ font-size:13px; opacity:0.8; margin-top:auto; text-align:right }

  /* flower base styles used by JS-inserted elements */
  .flower {
    position:absolute;
    width:48px;
    height:48px;
    transform-origin:center center;
    pointer-events:none;
    will-change: transform, opacity;
  }

  /* small sparkle */
  .spark{
    position:absolute;
    width:6px; height:6px;
    border-radius:50%;
    background:var(--accent);
    box-shadow: 0 0 8px rgba(255,215,235,0.9);
    opacity:0.0;
    pointer-events:none;
  }

  /* responsive */
  @media (max-width:980px){
    .stage{ grid-template-columns: 1fr; height:95vh; gap:10px; }
    .panel{ order:2; height:auto }
    .heart-wrap svg.heart{ width:240px; height:240px; }
  }
</style>
</head>
<body>
  <div class="stage" aria-label="Animasi Love Berbunga">
    <div class="canvas-wrap" id="canvasWrap">
      <canvas id="mainCanvas" aria-hidden="true"></canvas>

      <!-- Center heart SVG with soft gradient and bloom ring -->
      <div class="heart-wrap" aria-hidden="true">
        <div class="pulse">
        <svg class="heart" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Hati">
          <defs>
            <radialGradient id="gH" cx="40%" cy="30%" r="75%">
              <stop offset="0%" stop-color="#ffd6e8"/>
              <stop offset="40%" stop-color="#ff9fc4"/>
              <stop offset="100%" stop-color="#ff6ea1"/>
            </radialGradient>
            <filter id="softGlow" x="-50%" y="-50%" width="200%" height="200%">
              <feGaussianBlur stdDeviation="10" result="b"/>
              <feMerge>
                <feMergeNode in="b" />
                <feMergeNode in="SourceGraphic" />
              </feMerge>
            </filter>
          </defs>
          <g filter="url(#softGlow)">
            <path d="M462.3 62.7c-51.5-43.8-136-35.8-178.7 13.7L256 104.6l-27.6-28.2C185.7 26.9 101.2 19 49.7 62.7-10.6 116.7-7.6 211.2 43 264.4L239 459.1c12 12.3 32.2 12.3 44.2 0l196-194.7c50.6-53.2 53.6-147.7-22.9-201.7z" fill="url(#gH)"/>
          </g>
        </svg>
        </div>
      </div>
    </div>

    <aside class="panel">
      <h3>Love Berbunga â€” Pink Bloom</h3>
      <p>Animasi hati dikelilingi bunga-bunga pink yang mekar, berputar, dan melayang.</p>

      <div>
        <label>Jumlah bunga awal: <span id="countLabel">60</span></label>
        <input id="countRange" type="range" min="6" max="260" value="60">
      </div>

      <div>
        <label>Kecepatan gerak (x): <span id="speedLabel">1.0</span></label>
        <input id="speedRange" type="range" min="0.2" max="3" step="0.1" value="1.0">
      </div>

      <div class="controls">
        <button id="btnSpawn">Tambah 20 Bunga</button>
        <button id="btnClear">Hapus Semua</button>
        <button id="btnToggleAuto">Auto Spawn: ON</button>
      </div>

      <div style="margin-top:8px; font-size:13px;">
        Klik area untuk meletuskan bunga di posisi itu. Tekan <strong>Tambah</strong> untuk lebih banyak bunga.
      </div>

      <div class="meta">Dibuat dengan HTML/CSS/JS â€” buka di browser modern</div>
    </aside>
  </div>

<script>
/* =========================
   Konfigurasi & utilitas
   ========================= */
const canvas = document.getElementById('mainCanvas');
const wrap = document.getElementById('canvasWrap');
const ctx = canvas.getContext('2d');

let DPR = Math.max(1, window.devicePixelRatio || 1);

function resize(){
  const rect = wrap.getBoundingClientRect();
  canvas.width = Math.round(rect.width * DPR);
  canvas.height = Math.round(rect.height * DPR);
  canvas.style.width = rect.width + 'px';
  canvas.style.height = rect.height + 'px';
  ctx.setTransform(DPR,0,0,DPR,0,0);
}
window.addEventListener('resize', () => {
  DPR = Math.max(1, window.devicePixelRatio || 1);
  resize();
});
resize();

/* Random helpers */
const rand = (a,b) => Math.random()*(b-a)+a;
const choose = arr => arr[Math.floor(Math.random()*arr.length)];

/* Color palette (pinks) */
const PINKS = ['#ffcee8','#ffb0d0','#ff93b8','#ff6ea1','#ff4f8a','#ffc0d6'];

/* Flower object model
   - Each flower is drawn from petals (simple path) with a center.
   - Position, rotation, scale, velocity, life.
*/
class Flower {
  constructor(x,y,opts={}){
    this.x = x;
    this.y = y;
    this.baseX = x;
    this.baseY = y;
    this.vx = rand(-20,20) * 0.02;
    this.vy = rand(-40,-12) * 0.02;
    this.rotation = rand(0, Math.PI*2);
    this.spin = rand(-0.02, 0.02);
    this.scale = rand(0.6, 1.4) * (opts.sizeScale || 1);
    this.age = 0;
    this.life = opts.life ?? rand(160, 420);
    this.color = choose(PINKS);
    this.center = '#fff2f8';
    this.petals = Math.floor(rand(5,7));
    this.petalLen = rand(10,22);
    this.petalWidth = rand(6,12);
    this.opacity = 0;
    this.bloomTime = rand(18,60); // frames to reach visible
    this.floatSway = rand(6, 28);
    this.g = 0.045; // gravity like
  }
  update(dt, speedFactor){
    this.age += dt;
    // bloom (opacity & scale)
    if(this.age < this.bloomTime){
      this.opacity = this.age / this.bloomTime;
    } else {
      this.opacity = Math.max(0, 1 - (this.age - this.bloomTime) / (this.life - this.bloomTime));
    }
    // physics
    this.vy += this.g * dt * 0.6 * speedFactor;
    this.x += this.vx * dt * speedFactor + Math.sin(this.age / this.floatSway) * 0.12 * speedFactor;
    this.y += this.vy * dt * speedFactor;
    this.rotation += this.spin * dt * speedFactor;
  }
  draw(ctx){
    ctx.save();
    ctx.globalAlpha = Math.max(0, Math.min(1, this.opacity));
    ctx.translate(this.x, this.y);
    ctx.rotate(this.rotation);
    ctx.scale(this.scale, this.scale);

    // draw petals
    for(let i=0;i<this.petals;i++){
      const a = (i / this.petals) * Math.PI * 2;
      ctx.save();
      ctx.rotate(a);
      // petal path: simple ellipse-like shape using bezier
      ctx.beginPath();
      ctx.moveTo(0,0);
      ctx.bezierCurveTo(this.petalWidth * 0.2, -this.petalLen*0.35,
                       this.petalWidth * 0.8, -this.petalLen*0.85,
                       0, -this.petalLen);
      ctx.bezierCurveTo(-this.petalWidth * 0.8, -this.petalLen*0.85,
                       -this.petalWidth * 0.2, -this.petalLen*0.35,
                       0, 0);
      ctx.closePath();
      // gradient per petal
      const grad = ctx.createLinearGradient(0,-this.petalLen, 0, 2);
      grad.addColorStop(0, this.color);
      grad.addColorStop(1, this.center);
      ctx.fillStyle = grad;
      ctx.fill();
      ctx.restore();
    }

    // center
    ctx.beginPath();
    ctx.arc(0,0, Math.max(3, this.petalWidth*0.45), 0, Math.PI*2);
    ctx.fillStyle = '#fff9fb';
    ctx.fill();

    ctx.restore();
  }
  isDead(){
    return this.age > this.life || this.y > canvas.height + 40;
  }
}

/* Manager */
let flowers = [];
let autoSpawn = true;
let spawnTimer = 0;
let spawnInterval = 0.8; // seconds
let speedFactor = 1.0;

/* Create initial cluster around heart center */
function spawnCluster(count, cx, cy, spread=140, opts={}){
  for(let i=0;i<count;i++){
    const ang = Math.random()*Math.PI*2;
    const r = Math.sqrt(Math.random()) * spread;
    const x = cx + Math.cos(ang)*r + rand(-18,18);
    const y = cy + Math.sin(ang)*r + rand(-10,10) + 10;
    const f = new Flower(x,y,opts);
    // some petals small/large variety
    f.scale *= rand(0.75,1.4);
    flowers.push(f);
  }
}

/* initial spawn from center of canvas */
function initFlowers(n=60){
  flowers = [];
  const cx = canvas.width/DPR/2;
  const cy = canvas.height/DPR/2 - 10;
  spawnCluster(n, cx, cy, Math.min(180, Math.min(canvas.width/DPR, canvas.height/DPR)/3));
}

/* Animation loop */
let last = performance.now();
function loop(now){
  const dt = Math.min(40, now - last) / (1000/60); // normalized to ~frames (1 = 1 frame)
  last = now;
  // background clear (soft gradient)
  ctx.clearRect(0,0,canvas.width/DPR,canvas.height/DPR);
  // subtle vignette background (semi-manual)
  const g = ctx.createLinearGradient(0,0,0,canvas.height/DPR);
  g.addColorStop(0, 'rgba(255,240,250,0.02)');
  g.addColorStop(1, 'rgba(0,0,0,0.03)');
  ctx.fillStyle = g;
  ctx.fillRect(0,0,canvas.width/DPR,canvas.height/DPR);

  // update & draw flowers
  for(let i=flowers.length-1;i>=0;i--){
    const f = flowers[i];
    f.update(dt, speedFactor);
    f.draw(ctx);
    if(f.isDead()){
      flowers.splice(i,1);
    }
  }

  // soft floating sparkles (rare)
  if(Math.random() < 0.02){
    const sx = rand(40, canvas.width/DPR-40);
    const sy = rand(40, canvas.height/DPR-40);
    createSpark(sx, sy);
  }

  // auto spawn small bursts near heart
  if(autoSpawn){
    spawnTimer += dt*(1/60);
    if(spawnTimer > spawnInterval){
      spawnTimer = 0;
      const cx = canvas.width/DPR/2 + rand(-22,22);
      const cy = canvas.height/DPR/2 + rand(-12,22);
      spawnCluster(Math.floor(rand(3,9)), cx, cy, rand(40,110), { sizeScale: rand(0.7,1.1) });
    }
  }

  requestAnimationFrame(loop);
}

/* Spark effects drawn via DOM for performance (tiny) */
function createSpark(x,y){
  const el = document.createElement('div');
  el.className = 'spark';
  el.style.left = (x - 3) + 'px';
  el.style.top = (y - 3) + 'px';
  document.body.appendChild(el);
  let t = 0;
  const dur = rand(450,900);
  el.animate([
    { transform: 'scale(0.1)', opacity: 1, transformOrigin: 'center' },
    { transform: 'scale(1.4) translateY(-8px)', opacity: 0 }
  ], { duration: dur, easing: 'ease-out' });
  setTimeout(()=> el.remove(), dur + 40);
}

/* UI wiring */
const countRange = document.getElementById('countRange');
const countLabel = document.getElementById('countLabel');
const speedRange = document.getElementById('speedRange');
const speedLabel = document.getElementById('speedLabel');
const btnSpawn = document.getElementById('btnSpawn');
const btnClear = document.getElementById('btnClear');
const btnToggleAuto = document.getElementById('btnToggleAuto');

countRange.addEventListener('input', e=>{
  countLabel.textContent = e.target.value;
});
speedRange.addEventListener('input', e=>{
  speedFactor = parseFloat(e.target.value);
  speedLabel.textContent = speedFactor.toFixed(1);
});
btnSpawn.addEventListener('click', ()=>{
  const cx = canvas.width/DPR/2 + rand(-40,40);
  const cy = canvas.height/DPR/2 + rand(-10,40);
  spawnCluster(20, cx, cy, rand(40,160), { sizeScale: rand(0.85,1.15) });
});
btnClear.addEventListener('click', ()=>{
  flowers = [];
});
btnToggleAuto.addEventListener('click', ()=>{
  autoSpawn = !autoSpawn;
  btnToggleAuto.textContent = 'Auto Spawn: ' + (autoSpawn? 'ON' : 'OFF');
});

/* Click to burst */
wrap.addEventListener('click', (ev)=>{
  const rect = wrap.getBoundingClientRect();
  const x = (ev.clientX - rect.left);
  const y = (ev.clientY - rect.top);
  spawnCluster(18, x, y, rand(18,110), { sizeScale: rand(0.6,1.3) });
  // small sound (try)
  pulseAudio();
});

/* initial setup & start loop */
(function start(){
  resize();
  initFlowers(parseInt(countRange.value,10));
  requestAnimationFrame(loop);
})();

/* ensure when user changes initial count, we reinit */
countRange.addEventListener('change', ()=>{
  initFlowers(parseInt(countRange.value,10));
});

/* tiny audio pulse */
function pulseAudio(){
  try{
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = 'sine';
    o.frequency.value = 880;
    g.gain.value = 0.0001;
    o.connect(g); g.connect(audioCtx.destination);
    const t = audioCtx.currentTime;
    g.gain.setValueAtTime(0.0001,t);
    g.gain.exponentialRampToValueAtTime(0.05, t + 0.01);
    g.gain.exponentialRampToValueAtTime(0.0001, t + 0.18);
    o.start(t); o.stop(t + 0.2);
  }catch(e){
    // ignore on autoplay restrictions
  }
}

/* optional: gracefully reduce particles on small screens */
if(window.innerWidth < 640){
  speedFactor = 0.9;
  spawnInterval = 1.2;
}
</script>
</body>
</html>
